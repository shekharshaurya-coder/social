<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Buzz Feed</title>

    <!-- Main CSS -->
    <link rel="stylesheet" href="styles.css">

    <style>
        /* FIX SCROLLING */
        html, body {
            height: 100%;
            overflow-y: auto !important;   /* force scrolling */
            background: #0d0f15;
            color: white;
        }

        /* PAGE WRAPPER */
        .buzz-wrapper {
            width: 100%;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px 16px 40px;
        }

        /* TITLE BAR */
        .buzz-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 18px;
        }

        .buzz-title-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .buzz-title-left h1 {
            margin: 0;
            font-size: 26px;
            color: #fff;
        }

        .buzz-back-btn {
            background: #181a22;
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            border: 1px solid #2c3248;
            color: #e4e6eb;
            transition: 0.2s;
        }

        .buzz-back-btn:hover {
            background: #222533;
        }

        /* POSTS CONTAINER ‚Äî MUST SCROLL */
        .buzz-posts-container {
            width: 100%;
            padding-bottom: 60px;
        }

        /* POST CARD */
        .buzz-post {
            background: #111321;
            border-radius: 12px;
            border: 1px solid #1f2233;
            padding: 14px 16px;
            margin-bottom: 16px;
        }

        .buzz-post-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 6px;
        }

        .buzz-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #3b2562;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .buzz-user-block {
            display: flex;
            flex-direction: column;
        }

        .buzz-username {
            font-weight: 600;
            font-size: 14px;
            color: #fff;
        }

        .buzz-time {
            font-size: 11px;
            color: #9fa3b0;
        }

        .buzz-content {
            margin-top: 6px;
            font-size: 14px;
            line-height: 1.45;
            color: #ddd;
            white-space: pre-wrap;
        }

        /* MEDIA */
        .buzz-media {
            width: 100%;
            border-radius: 8px;
            margin-top: 8px;
            border: 1px solid #222;
        }

        .buzz-empty {
            margin-top: 15px;
            font-size: 15px;
            color: #888;
        }
    </style>
</head>

<body>
    <div class="buzz-wrapper">

        <!-- Header -->
        <div class="buzz-title-row">
            <div class="buzz-title-left">
                <span style="font-size:32px;">üî•</span>
                <h1>Buzz Feed</h1>
            </div>

            <button class="buzz-back-btn" onclick="window.location.href='index.html'">
                üè† Back
            </button>
        </div>

        <div id="buzz-status" style="color:#aaa; margin-bottom:10px;"></div>

        <!-- Scrollable post list -->
        <div class="buzz-posts-container" id="buzz-posts"></div>

    </div>

    <!-- JS -->
    <script>
        function escapeHtml(str = "") {
            return str.replace(/[&<>"]/g, c => ({
                "&": "&amp;",
                "<": "&lt;",
                ">": "&gt;",
                '"': "&quot;"
            }[c]));
        }

        // NO HASHTAG HIGHLIGHT
        function plainContent(text = "") {
            return escapeHtml(text);
        }

        async function loadTrending() {
            const status = document.getElementById("buzz-status");
            const container = document.getElementById("buzz-posts");
            const token = localStorage.getItem("token");

            status.textContent = "Loading trending posts...";

            try {
                const res = await fetch("/api/trending", {
                    headers: { Authorization: `Bearer ${token}` }
                });

                if (!res.ok) {
                    status.textContent = "Failed to load posts.";
                    return;
                }

                const data = await res.json();
                const posts = data.posts || [];

                if (!posts.length) {
                    container.innerHTML = `<div class="buzz-empty">No trending posts.</div>`;
                    status.textContent = "";
                    return;
                }

                container.innerHTML = posts.map(p => `
                    <div class="buzz-post">
                        <div class="buzz-post-header">
                            <div class="buzz-avatar">üë§</div>

                            <div class="buzz-user-block">
                                <div class="buzz-username">${escapeHtml(p.username || "")}</div>
                                <div class="buzz-time">${new Date(p.createdAt).toLocaleString()}</div>
                            </div>
                        </div>

                        <div class="buzz-content">${plainContent(p.content)}</div>

                        ${p.mediaUrl ? `<img class="buzz-media" src="${p.mediaUrl}" />` : ""}
                    </div>
                `).join("");

                status.textContent = "";
            }
            catch (err) {
                console.error(err);
                status.textContent = "Unable to connect to server.";
            }
        }

        loadTrending();
    </script>
</body>
</html>
